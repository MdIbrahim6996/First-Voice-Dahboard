<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Line Chart in Modal (FF28 compatible)</title>

  <!-- Chart.js v1.x (works on very old browsers incl. FF28) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.1.1/Chart.min.js"></script>

  <style>
    /* Page button */
    .btn {
      display: inline-block;
      padding: 8px 14px;
      background: #1b3c53;
      color: #fff;
      text-decoration: none;
      border-radius: 4px;
      cursor: pointer;
    }

    /* Modal overlay */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      opacity: 0; visibility: hidden;
      transition: opacity 0.25s ease, visibility 0.25s ease;
      z-index: 9998;
    }
    .modal-overlay.show {
      opacity: 1; visibility: visible;
    }

    /* Modal container (no flexbox) */
    .modal {
      position: fixed;
      top: 50%; left: 50%;
      width: 90%;
      max-width: 700px;
      background: #fff;
      border-radius: 6px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      transform: translate(-50%, -50%);
      opacity: 0; visibility: hidden;
      transition: opacity 0.25s ease, visibility 0.25s ease;
      z-index: 9999;
    }
    .modal.show {
      opacity: 1; visibility: visible;
    }

    .modal-header {
      padding: 10px 12px;
      border-bottom: 1px solid #eee;
      background: #f7f9fb;
    }
    .modal-title {
      margin: 0;
      font-size: 16px;
      color: #1b3c53;
    }
    .modal-body {
      padding: 12px;
    }
    .modal-footer {
      padding: 10px 12px;
      border-top: 1px solid #eee;
      text-align: right;
    }
    .close-btn {
      background: #d9534f;
      color: #fff;
      border: none;
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
    }

    /* Make canvas responsive inside modal (Chart.js v1 respects element size) */
    .chart-wrap {
      width: 100%;
      height: 360px; /* adjust as you like */
      position: relative;
    }
    .chart-wrap canvas {
      position: absolute;
      top: 0; left: 0;
      width: 100% !important;
      height: 100% !important;
    }
  </style>
</head>
<body>
  <a class="btn" id="openModalBtn">Open Line Chart</a>

  <!-- Overlay + Modal -->
  <div class="modal-overlay" id="overlay"></div>

  <div class="modal" id="chartModal" role="dialog" aria-modal="true" aria-labelledby="chartTitle">
    <div class="modal-header">
      <h3 class="modal-title" id="chartTitle">Sales (Last 7 Days)</h3>
    </div>
    <div class="modal-body">
      <div class="chart-wrap">
        <canvas id="lineCanvas">
          Your browser does not support canvas.
        </canvas>
      </div>
    </div>
    <div class="modal-footer">
      <button class="close-btn" id="closeModalBtn">Close</button>
    </div>
  </div>

  <script>
    // ES5 only (Firefox 28 safe)
    var openBtn = document.getElementById('openModalBtn');
    var closeBtn = document.getElementById('closeModalBtn');
    var overlay = document.getElementById('overlay');
    var modal = document.getElementById('chartModal');
    var chartInstance = null;

    function openModal() {
      overlay.className = 'modal-overlay show';
      modal.className = 'modal show';

      // Create chart after modal is visible so canvas has correct size
      // (If already created, destroy and recreate to fit size)
      createOrUpdateChart();
    }

    function closeModal() {
      overlay.className = 'modal-overlay';
      modal.className = 'modal';

      // Optional: destroy chart to free memory (Chart.js v1)
      if (chartInstance && chartInstance.destroy) {
        chartInstance.destroy();
        chartInstance = null;
      }
    }

    function createOrUpdateChart() {
      var canvas = document.getElementById('lineCanvas');
      var ctx = canvas.getContext('2d');

      // Example labels & data (replace with your real data)
      // In EJS, you can inject arrays safely like:
      // var labels = <%- JSON.stringify(labelsFromServer) %>;
      // var dataPoints = <%- JSON.stringify(valuesFromServer) %>;
      var labels = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
      var dataPoints = [12, 19, 7, 15, 22, 18, 25];

      var data = {
        labels: labels,
        datasets: [{
          label: 'Sales',
          fillColor: 'rgba(27,60,83,0.15)',
          strokeColor: '#1b3c53',
          pointColor: '#1b3c53',
          pointStrokeColor: '#fff',
          pointHighlightFill: '#fff',
          pointHighlightStroke: '#1b3c53',
          data: dataPoints
        }]
      };

      var options = {
        responsive: true,            // Chart.js v1 responsive mode
        maintainAspectRatio: false,  // fill the .chart-wrap height
        bezierCurve: true,
        bezierCurveTension: 0.4,
        pointDot: true,
        pointDotRadius: 3,
        datasetStrokeWidth: 2,
        scaleShowGridLines: true,
        scaleGridLineColor: 'rgba(0,0,0,.05)',
        scaleLineColor: 'rgba(0,0,0,.1)',
        scaleFontColor: '#444',
        animation: true,
        animationSteps: 30
      };

      // (Re)create chart
      if (chartInstance && chartInstance.destroy) {
        chartInstance.destroy();
      }
      chartInstance = new Chart(ctx).Line(data, options);
    }

    // Wire up events
    openBtn.addEventListener('click', openModal, false);
    closeBtn.addEventListener('click', closeModal, false);
    overlay.addEventListener('click', closeModal, false);

    // Optional: handle ESC key to close modal
    document.addEventListener('keydown', function (e) {
      e = e || window.event;
      if (e.keyCode === 27) { closeModal(); }
    }, false);
  </script>
</body>
</html>
